#!/bin/sh

#!/bin/bash
if ! [ $(id -u) = 0 ]; then
   echo "You should run this script as root/superuser."
   exit 1
fi

echo "Starting the Gitorious installation..."

echo "Setting Gitorious hostname..."
./change_hostname.sh

echo "Disabling SELinux..."
sed -i "s/enforcing/disabled/" /etc/selinux/config
setenforce 0

echo "Installing Ruby..."
./install-ruby.sh

echo "Make sure we are using the proper Ruby version..."
source /etc/profile.d/chruby.sh

echo "Installing Puppet..."
su -c "gem install -y --no-ri --no-rdoc puppet -v=2.7.11"

export FACTER_fqdn=$(hostname)

echo "Running rest of installation (with correct, newly installed Ruby)..."
su -c "./apply_and_finalize.sh"
